<div class="row h-100">
    <!-- Coluna da Esquerda: Formulário de Adicionar -->
    <div class="col-md-4 border-end pe-md-4">
        <div class="bg-light p-3 rounded border sticky-top" style="top: 20px; z-index: 1;">
            <h5 class="text-primary mb-3 fw-bold">{{ titulo }}</h5>
            
            <form method="POST" class="d-flex flex-column gap-2">
                {% csrf_token %}
                <input type="hidden" name="acao" value="{{ acao_add }}">
                
                <div class="input-group">
                    <input type="text" name="nome" class="form-control" placeholder="Digite o nome..." required autocomplete="off">
                    <button type="submit" class="btn btn-success" title="Adicionar">
                        <i class="fas fa-plus"></i>
                    </button>
                </div>
            </form>
            
            <div class="mt-3 text-muted small bg-white p-2 rounded border">
                <i class="fas fa-info-circle text-primary"></i> 
                Digite o nome (ex: "Soja Intacta", "Peneira 5.5") e clique no botão verde para salvar.
            </div>
        </div>
    </div>

    <!-- Coluna da Direita: Lista de Itens Cadastrados -->
    <div class="col-md-8 ps-md-4">
        <div class="d-flex justify-content-between align-items-center mb-3">
            <h5 class="text-secondary m-0">Itens Cadastrados</h5>
            <span class="badge bg-secondary" id="count-{{ tipo }}">{{ lista|length }} itens</span>
        </div>

        <!-- CAMPO DE PESQUISA RÁPIDA -->
        <div class="mb-3 position-relative">
            <i class="fas fa-search position-absolute text-muted" style="left: 10px; top: 10px;"></i>
            <input type="text" 
                   class="form-control ps-5" 
                   id="search-{{ tipo }}" 
                   placeholder="Pesquisar nesta lista..." 
                   onkeyup="filtrarLista('{{ tipo }}')">
        </div>

        <!-- LISTA COM SCROLL (BARRA DE ROLAGEM) -->
        <div class="scroll-container" style="max-height: 400px; min-height: 200px;">
            <div class="d-flex flex-wrap gap-2" id="list-container-{{ tipo }}">
                {% for item in lista %}
                <span class="badge bg-white text-dark border badge-item shadow-sm">
                    <span class="item-name fw-bold">{{ item.nome }}</span>
                    
                    <!-- Botão de excluir -->
                    <form method="POST" style="display:inline;" onsubmit="return confirm('Excluir {{ item.nome }}?');">
                        {% csrf_token %}
                        <input type="hidden" name="acao" value="delete_item">
                        <input type="hidden" name="tipo_item" value="{{ tipo }}">
                        <input type="hidden" name="id_item" value="{{ item.id }}">
                        <button type="submit" class="btn btn-sm text-danger py-0 px-1 border-0 hover-danger" title="Excluir">
                            <i class="fas fa-times"></i>
                        </button>
                    </form>
                </span>
                {% empty %}
                <div class="text-center w-100 py-5 text-muted">
                    <i class="fa-regular fa-folder-open fa-2x mb-2 opacity-50"></i>
                    <p>Nenhum item cadastrado.</p>
                </div>
                {% endfor %}
            </div>
            
            <!-- Mensagem se a pesquisa não encontrar nada -->
            <div id="no-results-{{ tipo }}" class="text-center py-4 text-muted d-none">
                <i class="fas fa-search me-1"></i> Nenhum item encontrado para sua busca.
            </div>
        </div>
    </div>
</div>

<script>
    function filtrarLista(tipo) {
        const input = document.getElementById('search-' + tipo);
        const filter = input.value.toLowerCase();
        const container = document.getElementById('list-container-' + tipo);
        const items = container.getElementsByClassName('badge-item');
        let visibleCount = 0;

        for (let i = 0; i < items.length; i++) {
            const spanName = items[i].getElementsByClassName('item-name')[0];
            const txtValue = spanName.textContent || spanName.innerText;
            
            if (txtValue.toLowerCase().indexOf(filter) > -1) {
                items[i].style.display = "";
                visibleCount++;
            } else {
                items[i].style.display = "none";
            }
        }

        // Mostrar mensagem se não achar nada
        const noResults = document.getElementById('no-results-' + tipo);
        if (visibleCount === 0 && items.length > 0) {
            noResults.classList.remove('d-none');
        } else {
            noResults.classList.add('d-none');
        }
    }
</script>